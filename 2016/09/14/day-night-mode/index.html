<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 一次渐变日夜模式实践 · 词不悉心</title><meta name="description" content="一次渐变日夜模式实践 - MingJian"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="词不悉心"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/echohce" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">一次渐变日夜模式实践</h1><div class="post-info">2016年9月14日</div><div class="post-content"><p>近些天看到一篇关于Support Library的日夜模式讲解的博客，感觉很实用，特意学习一番记录如下。</p>
<blockquote>
<p>关于DayNight主题</p>
</blockquote>
<p>Support Library 23.2.0之后，AppCompat有了一个新主题: Theme.AppCompat.DayNight, 这个主题可以根据系统时间或者当地经纬度等信息进行暗色和亮色主题的切换</p>
<a id="more"></a>
<blockquote>
<p>效果图展示</p>
</blockquote>
<p><img src="DayNightMode.gif" alt="DayNightMode"></p>
<h4 id="如何使用DayNight主题"><a href="#如何使用DayNight主题" class="headerlink" title="如何使用DayNight主题"></a>如何使用DayNight主题</h4><ul>
<li>首先需要Android Support Library v7库在 23.2.0之上</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">compile 'com.android.support:appcompat-v7:23.2.0'</div></pre></td></tr></table></figure>
<ul>
<li>修改自己的App Theme</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"AppTheme"</span> <span class="attr">parent</span>=<span class="string">"Theme.AppCompat.DayNight.DarkActionBar"</span>&gt;</span><span class="undefined"></span></div></pre></td></tr></table></figure>
<ul>
<li>然后创建夜间colors.xml, 将相关颜色的放在这里面</li>
</ul>
<p>我们可以利用AS快速创建colors.xml(right) ,  过程如下。</p>
<p><img src="DayNightMode.png" alt="2"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">// colors.xml</div><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"colorPrimary"</span>&gt;</span>#3F51B5<span class="tag">&lt;/<span class="name">color</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"colorPrimaryDark"</span>&gt;</span>#303F9F<span class="tag">&lt;/<span class="name">color</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"colorAccent"</span>&gt;</span>#FF4081<span class="tag">&lt;/<span class="name">color</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"white"</span>&gt;</span>#FFFFFF<span class="tag">&lt;/<span class="name">color</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div><div class="line"></div><div class="line">// colors.xml(night)</div><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"colorPrimary"</span>&gt;</span>#242c58<span class="tag">&lt;/<span class="name">color</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"colorPrimaryDark"</span>&gt;</span>#2f334e<span class="tag">&lt;/<span class="name">color</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">color</span> <span class="attr">name</span>=<span class="string">"colorAccent"</span>&gt;</span>#9890df<span class="tag">&lt;/<span class="name">color</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resources</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>因为我们还需要实现渐变的效果，所以需要定义相关animation, 相关文件如下</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">//Style</div><div class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"WindowAnimationFadeInOut"</span>&gt;</span><span class="xml"></span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"@android:windowEnterAnimation"</span>&gt;</span>@anim/fade_in<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"@android:windowExitAnimation"</span>&gt;</span>@anim/fade_out<span class="tag">&lt;/<span class="name">item</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">//@anim/fade_in</div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">alpha</span></span></div><div class="line">        <span class="attr">android:duration</span>=<span class="string">"1000"</span></div><div class="line">        <span class="attr">android:fromAlpha</span>=<span class="string">"0"</span></div><div class="line">        <span class="attr">android:interpolator</span>=<span class="string">"@android:anim/decelerate_interpolator"</span></div><div class="line">        <span class="attr">android:toAlpha</span>=<span class="string">"1.0"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">//@anim/fade_out</div><div class="line"><span class="tag">&lt;<span class="name">set</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">alpha</span></span></div><div class="line">        <span class="attr">android:duration</span>=<span class="string">"1500"</span></div><div class="line">        <span class="attr">android:fromAlpha</span>=<span class="string">"1.0"</span></div><div class="line">        <span class="attr">android:interpolator</span>=<span class="string">"@android:anim/decelerate_interpolator"</span></div><div class="line">        <span class="attr">android:toAlpha</span>=<span class="string">"0"</span> /&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">set</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>相关代码控制</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">changeDayNightMode</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="comment">// getFlag是自己定义在Application中的一个静态方法 获取一个flag值（Boolean）修改模式。</span></div><div class="line">    <span class="keyword">if</span> (TestApp.getFlag())&#123;</div><div class="line">        <span class="comment">/*  MODE_NIGHT_NO   - 日间模式</span></div><div class="line">         *  MODE_NIGHT_YES  - 夜间模式</div><div class="line">         *  MODE_NIGHT_AUTO - 根据时间自动切换</div><div class="line">         *  MODE_NIGHT_FOLLOW_SYSTEM(Default) - 根据系统</div><div class="line">         */</div><div class="line">        AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_NO);</div><div class="line">        TestApp.changeFlag();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_YES);</div><div class="line">        TestApp.changeFlag();</div><div class="line">    &#125;</div><div class="line">    getWindow().setWindowAnimations(R.style.WindowAnimationFadeInOut);</div><div class="line">    Logger.d(TestApp.getFlag());</div><div class="line">    </div><div class="line">    <span class="comment">// 会重新create整个Activity</span></div><div class="line">    recreate();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Tip"><a href="#Tip" class="headerlink" title="Tip:"></a>Tip:</h4><p>遇到的一个问题是，发现如果在<code>Activity</code>中定义一个静态量作为<code>flag</code>的话，发现是行不通的，最后才发现<code>changeDayNightMode</code>方法中会调用<code>recreate()</code> 重新创建一个instance.</p>
<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><ol>
<li><a href="https://kingideayou.github.io/2016/03/07/appcompat_23.2_day_night/" target="_blank" rel="external">https://kingideayou.github.io/2016/03/07/appcompat_23.2_day_night/</a></li>
<li><a href="http://www.jianshu.com/p/f30ebec8b4ed" target="_blank" rel="external">http://www.jianshu.com/p/f30ebec8b4ed</a></li>
<li><a href="http://imxie.cc/2016/07/12/Android-New-Day-Night-Swtich/" target="_blank" rel="external">http://imxie.cc/2016/07/12/Android-New-Day-Night-Swtich/</a></li>
</ol>
</div></article></div></section><footer><div class="paginator"><a href="/2016/10/06/debug-app-over-wifi/" class="prev">上一篇</a><a href="/2016/09/07/bitmap-and-cache/" class="next">下一篇</a></div><div class="copyright"><p>© 2016 <a href="http://yoursite.com">MingJian</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65933410-1",'auto');ga('send','pageview');</script></body></html>